---
# Source: call-n-cache/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: curl-n-cache-call-n-cache
  labels:
    helm.sh/chart: call-n-cache-0.1.0
    app.kubernetes.io/name: call-n-cache
    app.kubernetes.io/instance: curl-n-cache
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: true
---
# Source: call-n-cache/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: curl-n-cache-call-n-cache
  labels:
    helm.sh/chart: call-n-cache-0.1.0
    app.kubernetes.io/name: call-n-cache
    app.kubernetes.io/instance: curl-n-cache
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
    - port: 58080
      targetPort: metrics
      protocol: TCP
      name: metrics
  selector:
    app.kubernetes.io/name: call-n-cache
    app.kubernetes.io/instance: curl-n-cache
---
# Source: call-n-cache/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: curl-n-cache-call-n-cache
  labels:
    helm.sh/chart: call-n-cache-0.1.0
    app.kubernetes.io/name: call-n-cache
    app.kubernetes.io/instance: curl-n-cache
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: call-n-cache
      app.kubernetes.io/instance: curl-n-cache
  template:
    metadata:
      labels:
        helm.sh/chart: call-n-cache-0.1.0
        app.kubernetes.io/name: call-n-cache
        app.kubernetes.io/instance: curl-n-cache
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: curl-n-cache-call-n-cache
      securityContext:
        {}
      containers:
        - name: call-n-cache
          securityContext:
            securityContext:
              allowPrivilegeEscalation: false
              capabilities:
                drop:
                - ALL
              privileged: false
              readOnlyRootFilesystem: true
              runAsGroup: 10001
              runAsNonRoot: true
              runAsUser: 10001
          image: "redsailtechnologies/call-n-cache:latest"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
            - name: metrics
              containerPort: 58080
              protocol: TCP
          startupProbe:
            httpGet:
              path: /health
              port: http
            failureThreshold: 60
            periodSeconds: 1
          livenessProbe:
            httpGet:
              path: /health
              port: http
            failureThreshold: 1
          readinessProbe:
            httpGet:
              path: /health
              port: http
            failureThreshold: 1
          resources:
            {}
          env:
            - name: ASPNETCORE_ENVIRONMENT
              value: "Production"
            - name: ASPNETCORE_URLS
              value: "http://+:8080;http://+:58080"
            - name: Base64Payload
              value: "eyJxdWVyeSI6InthY3RvciB7YWNjb3VudChpZDogMzk3NTgyMSkge25ycWwocXVlcnk6IFwiU0VMRUNUIGZpbHRlcihjb3VudChgbmV3cmVsaWMuZ29sZGVubWV0cmljcy5zeW50aC5tb25pdG9yLmZhaWx1cmVzYCksIFdIRVJFIGVudGl0eS5ndWlkIGluIChcdTAwMjdNemszTlRneU1YeFRXVTVVU0h4TlQwNUpWRTlTZkRJeU9UVTFNekV6TFRRMlptUXROR0ZqWmkxaVltUTRMVE5sTXpZeFptWTNZVEppTkFcdTAwMjcpKSBBUyBcdTAwMjdBeHlzXHUwMDI3LCBmaWx0ZXIoY291bnQoYG5ld3JlbGljLmdvbGRlbm1ldHJpY3Muc3ludGgubW9uaXRvci5mYWlsdXJlc2ApLCBXSEVSRSBlbnRpdHkuZ3VpZCBpbiAoXHUwMDI3TXprM05UZ3lNWHhUV1U1VVNIeE5UMDVKVkU5U2ZESTVZbVV4WVdGbUxXSXlOakl0TkRsaFlpMWhZamN5TFRaalkyRTJaak01T0RFMVlRXHUwMDI3KSkgQVMgXHUwMDI3Q2hhcnRcdTAwMjcsIGZpbHRlcihjb3VudChgbmV3cmVsaWMuZ29sZGVubWV0cmljcy5zeW50aC5tb25pdG9yLmZhaWx1cmVzYCksIFdIRVJFIGVudGl0eS5ndWlkIGluIChcdTAwMjdNemszTlRneU1YeFRXVTVVU0h4TlQwNUpWRTlTZkdOak9UUmpOalV4TFdRek5qWXROREZtTlMwNVl6VTRMVGt4WlRNNU4yUXlaakF6WXdcdTAwMjcpKSBBUyBcdTAwMjdLYW52b1x1MDAyNywgZmlsdGVyKGNvdW50KGBuZXdyZWxpYy5nb2xkZW5tZXRyaWNzLnN5bnRoLm1vbml0b3IuZmFpbHVyZXNgKSwgV0hFUkUgZW50aXR5Lmd1aWQgaW4gKFx1MDAyN016azNOVGd5TVh4VFdVNVVTSHhOVDA1SlZFOVNmRGt3TkdVNE1EUTFMV0l5WkRRdE5EUXhaaTA1WldVNUxUaGlaakV5Wm1SbE16STFOd1x1MDAyNykpIEFTIFx1MDAyN0NQRVx1MDAyNywgZmlsdGVyKGNvdW50KGBuZXdyZWxpYy5nb2xkZW5tZXRyaWNzLnN5bnRoLm1vbml0b3IuZmFpbHVyZXNgKSwgV0hFUkUgZW50aXR5Lmd1aWQgaW4gKFx1MDAyN016azNOVGd5TVh4VFdVNVVTSHhOVDA1SlZFOVNmREppWkdVM01HVXpMVGxtTlRndE5EbGtZaTA0TUdVM0xXTTFPVEJqWTJZMlpqazRaQVx1MDAyNykpIEFTIFx1MDAyN0NJU1x1MDAyNyBGUk9NIE1ldHJpYyBTSU5DRSA4IE1JTlVURVMgQUdPXCIpIHtyZXN1bHRzfX19fSIsICJ2YXJpYWJsZXMiOiIifQ=="
            - name: COMPlus_EnableDiagnostics
              value: "0"
            - name: Headers__API-Key
              value: "NRAK-S4W8Q7WJAD32F8B30F43VXR6BLS"
            - name: Uri
              value: "https://api.newrelic.com/graphql"
---
# Source: call-n-cache/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "curl-n-cache-call-n-cache-test-connection"
  labels:
    helm.sh/chart: call-n-cache-0.1.0
    app.kubernetes.io/name: call-n-cache
    app.kubernetes.io/instance: curl-n-cache
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['curl-n-cache-call-n-cache:80']
  restartPolicy: Never
